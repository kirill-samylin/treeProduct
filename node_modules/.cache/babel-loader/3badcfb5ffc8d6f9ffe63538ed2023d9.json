{"ast":null,"code":"var _jsxFileName = \"/Users/kirillsamylin/Desktop/table/stop-list/src/components/Tree/Tree.js\",\n    _s = $RefreshSig$();\n\nimport React, { createRef, useEffect, memo } from \"react\";\nimport styles from \"./Tree.module.css\";\nimport { Category, Product } from \"../\";\nimport cn from \"classnames\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const Tree = /*#__PURE__*/memo(_c = _s(({\n  id,\n  categories,\n  products,\n  className,\n  expanded\n}) => {\n  _s();\n\n  const treeElement = /*#__PURE__*/createRef(null);\n\n  function getKey({\n    category_id,\n    product_id,\n    parent_id\n  }) {\n    if (!parent_id) {\n      return category_id;\n    }\n\n    if (!product_id) {\n      return category_id;\n    }\n\n    return product_id;\n  }\n\n  const onEnd = evt => {\n    const oldIndex = evt.oldIndex;\n    const index = evt.newIndex;\n    const item = evt.item;\n    const parent = evt.to;\n    const oldParent = evt.from;\n    const id = item.dataset.id;\n    const name = item.dataset.name;\n    const categoryId = parent.dataset.id;\n    const oldCategoryId = oldParent.dataset.id;\n    if (oldIndex === index && parent === oldParent) return;\n    console.log({\n      \"id предмета\": id,\n      \"id категории куда суем\": categoryId,\n      \"id категории откуда удаляем\": oldCategoryId,\n      \"index - место куда вставляем\": index,\n      \"oldIndex - место откуда вырезаем\": oldIndex,\n      \"тип\": name\n    });\n  };\n\n  const onMove = evt => {\n    const parent = evt.to;\n    const item = evt.dragged;\n    const category_id = parent.dataset.id;\n    const name = item.dataset.name;\n    if (category_id === \"root\" && name === \"product\") return false;\n    return true;\n  };\n\n  useEffect(() => {\n    window.$(treeElement.current).sortable({\n      fallbackOnBody: false,\n      // selectedClass: styles.selected,\n      // multiDrag: true,\n      group: {\n        name: \"list\"\n      },\n      animation: 200,\n      ghostClass: \"ghost\",\n      handle: \".position\",\n      onEnd,\n      onMove\n    });\n  }, [treeElement]);\n  return /*#__PURE__*/_jsxDEV(\"ul\", {\n    ref: treeElement,\n    \"data-id\": id,\n    className: cn(styles.tree, className, \"list-group\", {\n      [styles.open]: expanded\n    }),\n    children: [categories && categories.map(branch => /*#__PURE__*/_jsxDEV(Category, {\n      product: branch\n    }, getKey(branch.category_id), false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 11\n    }, this)), categories && categories.map(branch => /*#__PURE__*/_jsxDEV(Product, {\n      product: branch\n    }, getKey(branch), false, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 11\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 67,\n    columnNumber: 5\n  }, this);\n}, \"OD7bBpZva5O2jO+Puf00hKivP7c=\"));\n_c2 = Tree;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Tree$memo\");\n$RefreshReg$(_c2, \"Tree\");","map":{"version":3,"sources":["/Users/kirillsamylin/Desktop/table/stop-list/src/components/Tree/Tree.js"],"names":["React","createRef","useEffect","memo","styles","Category","Product","cn","Tree","id","categories","products","className","expanded","treeElement","getKey","category_id","product_id","parent_id","onEnd","evt","oldIndex","index","newIndex","item","parent","to","oldParent","from","dataset","name","categoryId","oldCategoryId","console","log","onMove","dragged","window","$","current","sortable","fallbackOnBody","group","animation","ghostClass","handle","tree","open","map","branch"],"mappings":"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","sourcesContent":["import React, { createRef, useEffect, memo } from \"react\";\nimport styles from \"./Tree.module.css\";\nimport { Category, Product } from \"../\";\nimport cn from \"classnames\";\n\nexport const Tree = memo(({ id, categories, products, className, expanded }) => {\n  const treeElement = createRef(null);\n  function getKey({ category_id, product_id, parent_id }) {\n    if (!parent_id) {\n      return category_id;\n    }\n    if (!product_id) {\n      return category_id;\n    }\n    return product_id;\n  }\n\n  const onEnd = (evt) => {\n    const oldIndex = evt.oldIndex;\n    const index = evt.newIndex;\n    const item = evt.item;\n    const parent = evt.to;\n    const oldParent = evt.from;\n    const id = item.dataset.id;\n    const name = item.dataset.name;\n    const categoryId = parent.dataset.id;\n    const oldCategoryId = oldParent.dataset.id;\n\n    if (oldIndex === index && parent === oldParent) return;\n\n    console.log({\n      \"id предмета\": id,\n      \"id категории куда суем\": categoryId,\n      \"id категории откуда удаляем\": oldCategoryId,\n      \"index - место куда вставляем\": index,\n      \"oldIndex - место откуда вырезаем\": oldIndex,\n      \"тип\": name,\n    });\n  };\n\n  const onMove = (evt) => {\n    const parent = evt.to;\n    const item = evt.dragged;\n    const category_id = parent.dataset.id;\n    const name = item.dataset.name;\n    if (category_id === \"root\" && name === \"product\") return false;\n    return true;\n  };\n\n  useEffect(() => {\n    window.$(treeElement.current).sortable({\n      fallbackOnBody: false,\n      // selectedClass: styles.selected,\n      // multiDrag: true,\n      group: {\n        name: \"list\",\n      },\n      animation: 200,\n      ghostClass: \"ghost\",\n      handle: \".position\",\n      onEnd,\n      onMove,\n    });\n  }, [treeElement]);\n\n  return (\n    <ul\n      ref={treeElement}\n      data-id={id}\n      className={cn(styles.tree, className, \"list-group\", {\n        [styles.open]: expanded,\n      })}\n    >\n      {categories &&\n        categories.map((branch) =>\n          <Category key={getKey(branch.category_id)} product={branch} />\n        )}\n      {categories &&\n        categories.map((branch) =>\n          <Product key={getKey(branch)} product={branch} />\n        )}\n    </ul>\n  );\n});\n"]},"metadata":{},"sourceType":"module"}